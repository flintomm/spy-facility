# 2026-02-14 — Two-Floor Facility + Status Fix

## Status Fix (Flint stuck in WORKING)
**Problem:** Flint was stuck showing "working" even when idle.
**Root Cause:** The server was using `recentlyActive` Map to track activity, but the grace period logic was setting status to true without proper expiration checks. Also, the CLI session check for `agent:main:main` was directly setting Flint to working.
**Fix:**
1. Removed the direct `agent:main:main` → Flint working mapping from CLI checks (rely on file watcher instead)
2. Added proper grace period handling using `recentlyActive` Map with 30-second expiration
3. Agents now correctly fall back to "idle" after the grace period expires

## Two-Floor Layout (Mobile-Optimized)
**Goal:** Make facility more vertical/mobile-friendly for iPhone 17
**Implementation:**

### Floor System
- **Floor 1 (OPS):** Operations floor with pods, R&D Lab, Command, Galley, Lounge
- **Floor 2 (QUARTERS):** Residential quarters for Flint, Cipher, Atlas

### Technical Changes
1. **Dual Canvas System:**
   - `floorCanvases.ops` and `floorCanvases.quarters` - separate offscreen canvases
   - `currentFloor` state variable tracks which floor is active
   - `renderOperationsBackground()` and `renderQuartersBackground()` render each floor

2. **Floor Toggle UI:**
   - Desktop: Floor buttons in status bar ("OPS FLOOR" / "QUARTERS")
   - Mobile: Floor buttons in mobile toolbar ("OPS F1" / "QTRS F2")
   - Click handlers switch floors and redraw

3. **Quarters Floor Features:**
   - 3 personalized bedrooms with beds
   - Agent sprites shown in their quarters
   - Lucky (dog) shown in Flint's quarters
   - Floor label in header ("QUARTERS LEVEL")

4. **Operations Floor Features:**
   - Single row of 4 pods (removed second row)
   - All original rooms (R&D, Command, Galley, Lounge)
   - Agent sprites walking around when working
   - Floor label in header ("OPS FLOOR")

### Files Modified
- `index.html`: Major refactor for two-floor system
- `server.js`: Status detection fix
- `logs/2026-02-14-two-floor.md`: This log

### Mobile Improvements
- Vertical layout better fits iPhone 17 screen
- Floor toggle buttons always accessible
- Each floor is a full 1100x720 canvas (no scrolling within floor)
- Zoom/pan still works on each floor independently
